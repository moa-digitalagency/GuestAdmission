{% extends "base_platform_admin.html" %}

{% block title %}Platform Admin{% endblock %}
{% block page_title %}Platform Admin Dashboard{% endblock %}

{% block content %}

<!-- Dashboard Section -->
<div id="dashboardSection" class="content-section">
    <h2 style="margin-bottom: 1.5rem;">Statistiques globales</h2>
    <div class="stats-grid">
        <div class="stat-card blue">
            <div class="stat-label">Comptes Tenants</div>
            <div class="stat-value" id="statTenantsActifs">0</div>
            <small style="color: #6b7280;">actifs</small>
        </div>
        <div class="stat-card green">
            <div class="stat-label">√âtablissements</div>
            <div class="stat-value" id="statEtablissementsActifs">0</div>
            <small style="color: #6b7280;">actifs</small>
        </div>
        <div class="stat-card purple">
            <div class="stat-label">Admins</div>
            <div class="stat-value" id="statTotalAdmins">0</div>
        </div>
        <div class="stat-card orange">
            <div class="stat-label">S√©jours</div>
            <div class="stat-value" id="statTotalSejours">0</div>
        </div>
    </div>
</div>

<!-- Tenants Section -->
<div id="tenantsSection" class="content-section" style="display: none;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2 style="margin: 0;">Comptes clients (Tenants)</h2>
        <button class="btn btn-success" onclick="openCreateTenantModal()">
            ‚ûï Cr√©er un compte client
        </button>
    </div>
    <div id="tenantsList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem;"></div>
</div>

<!-- Etablissements Section -->
<div id="etablissementsSection" class="content-section" style="display: none;">
    <h2 style="margin-bottom: 1.5rem;">Tous les √©tablissements</h2>
    <div id="etablissementsList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;"></div>
</div>

<!-- Users Section -->
<div id="usersSection" class="content-section" style="display: none;">
    <h2 style="margin-bottom: 1.5rem;">Tous les utilisateurs</h2>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Nom</th>
                    <th>Pr√©nom</th>
                    <th>Email</th>
                    <th>Username</th>
                    <th>√âtablissements</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="usersList"></tbody>
        </table>
    </div>
</div>

<!-- Settings Section -->
<div id="settingsSection" class="content-section" style="display: none;">
    <h2 style="margin-bottom: 1.5rem;">Param√®tres de la plateforme</h2>
    
    <form id="platformSettingsForm" class="dotted-section section-purple">
        <h3 style="margin-bottom: 1.5rem;">Configuration g√©n√©rale</h3>
        
        <div class="form-grid">
            <div class="form-group">
                <label>Nom de la plateforme *</label>
                <input type="text" id="platform_name" name="platform_name" required>
            </div>
            
            <div class="form-group">
                <label>URL du logo</label>
                <input type="text" id="platform_logo_url" name="platform_logo_url" placeholder="https://...">
            </div>
            
            <div class="form-group">
                <label>Email de support</label>
                <input type="email" id="support_email" name="support_email">
            </div>
            
            <div class="form-group">
                <label>T√©l√©phone de support</label>
                <input type="tel" id="support_phone" name="support_phone">
            </div>
            
            <div class="form-group">
                <label>Devise par d√©faut</label>
                <select id="default_currency" name="default_currency">
                    <option value="MAD">MAD (Dirham marocain)</option>
                    <option value="EUR">EUR (Euro)</option>
                    <option value="USD">USD (Dollar)</option>
                    <option value="GBP">GBP (Livre sterling)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Langue par d√©faut</label>
                <select id="default_language" name="default_language">
                    <option value="fr">Fran√ßais</option>
                    <option value="en">English</option>
                    <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                </select>
            </div>
            
            <div class="form-group" style="grid-column: 1 / -1;">
                <label>
                    <input type="checkbox" id="maintenance_mode" name="maintenance_mode">
                    Mode maintenance activ√©
                </label>
            </div>
            
            <div class="form-group" style="grid-column: 1 / -1;">
                <label>Message de maintenance</label>
                <textarea id="maintenance_message" name="maintenance_message" rows="2" placeholder="La plateforme est en maintenance..."></textarea>
            </div>
        </div>
        
        <hr style="margin: 1.5rem 0; border: none; border-top: 2px dotted #d1d5db;">
        
        <h3 style="margin-bottom: 1.5rem;">SEO et Meta</h3>
        <div class="form-grid">
            <div class="form-group" style="grid-column: 1 / -1;">
                <label>Titre Meta</label>
                <input type="text" id="meta_title" name="meta_title">
            </div>
            
            <div class="form-group" style="grid-column: 1 / -1;">
                <label>Description Meta</label>
                <textarea id="meta_description" name="meta_description" rows="2"></textarea>
            </div>
            
            <div class="form-group" style="grid-column: 1 / -1;">
                <label>Mots-cl√©s Meta</label>
                <input type="text" id="meta_keywords" name="meta_keywords" placeholder="mot1, mot2, mot3">
            </div>
        </div>
        
        <div class="button-group" style="justify-content: flex-end; margin-top: 1.5rem;">
            <button type="button" class="btn btn-secondary" onclick="loadPlatformSettings()">Annuler</button>
            <button type="button" class="btn btn-success" onclick="savePlatformSettings()">üíæ Enregistrer</button>
        </div>
    </form>
</div>

<!-- Create Tenant Modal - Wizard Multi-√©tapes -->
<div class="modal" id="createTenantModal">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h3 style="margin: 0;">Cr√©er un nouveau compte client</h3>
            <button class="modal-close" onclick="closeCreateTenantModal()">‚úï</button>
        </div>
        
        <!-- Progress Indicator -->
        <div style="display: flex; justify-content: space-between; margin-bottom: 2rem; position: relative;">
            <div style="position: absolute; top: 15px; left: 0; right: 0; height: 2px; background: #e5e7eb; z-index: 0;"></div>
            <div class="wizard-step" data-step="1">
                <div class="wizard-step-number active">1</div>
                <div class="wizard-step-label">√âtablissement</div>
            </div>
            <div class="wizard-step" data-step="2">
                <div class="wizard-step-number">2</div>
                <div class="wizard-step-label">Administrateur</div>
            </div>
            <div class="wizard-step" data-step="3">
                <div class="wizard-step-number">3</div>
                <div class="wizard-step-label">Chambres</div>
            </div>
            <div class="wizard-step" data-step="4">
                <div class="wizard-step-number">4</div>
                <div class="wizard-step-label">R√©capitulatif</div>
            </div>
        </div>
        
        <form id="createTenantForm">
            <!-- √âtape 1: Informations √âtablissement -->
            <div class="wizard-content" id="wizardStep1">
                <h4 style="margin-bottom: 1.5rem; color: #6366f1;">√âtape 1 : Informations de l'√©tablissement</h4>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nom du compte *</label>
                        <input type="text" name="nom_compte" id="nom_compte" required>
                    </div>
                    <div class="form-group">
                        <label>Nom de l'√©tablissement *</label>
                        <input type="text" name="nom_etablissement" id="nom_etablissement" required>
                    </div>
                    <div class="form-group">
                        <label>Num√©ro d'identification (ICE, SIRET, EIN, etc.)</label>
                        <input type="text" name="numero_identification" id="numero_identification">
                    </div>
                    <div class="form-group">
                        <label>Logo de l'√©tablissement (URL)</label>
                        <input type="text" name="logo_url" id="logo_url" placeholder="https://...">
                    </div>
                    <div class="form-group">
                        <label>Pays *</label>
                        <select name="pays" id="pays" required onchange="loadVillesForPays()">
                            <option value="">S√©lectionnez un pays</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ville *</label>
                        <select name="ville" id="ville" required>
                            <option value="">S√©lectionnez d'abord un pays</option>
                        </select>
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Adresse compl√®te</label>
                        <textarea name="adresse" id="adresse" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label>T√©l√©phone</label>
                        <input type="tel" name="telephone" id="telephone">
                    </div>
                    <div class="form-group">
                        <label>WhatsApp</label>
                        <input type="tel" name="whatsapp" id="whatsapp">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" name="email_etablissement" id="email_etablissement">
                    </div>
                    <div class="form-group">
                        <label>Devise</label>
                        <select name="devise" id="devise">
                            <option value="MAD">MAD (Dirham marocain)</option>
                            <option value="EUR">EUR (Euro)</option>
                            <option value="USD">USD (Dollar)</option>
                            <option value="GBP">GBP (Livre sterling)</option>
                            <option value="TND">TND (Dinar tunisien)</option>
                            <option value="DZD">DZD (Dinar alg√©rien)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Taxe de s√©jour (%)</label>
                        <input type="number" name="taux_taxe_sejour" id="taux_taxe_sejour" min="0" max="100" step="0.1" placeholder="2.5">
                    </div>
                    <div class="form-group">
                        <label>TVA (%)</label>
                        <input type="number" name="taux_tva" id="taux_tva" min="0" max="100" step="0.1" placeholder="20">
                    </div>
                    <div class="form-group">
                        <label>Charge plateforme (%)</label>
                        <input type="number" name="taux_charge_plateforme" id="taux_charge_plateforme" min="0" max="100" step="0.1" placeholder="15">
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Format du num√©ro de s√©jour</label>
                        <input type="text" name="format_numero_reservation" id="format_numero_reservation" value="RES-{YYYY}{MM}{DD}-{NUM}" placeholder="RES-{YYYY}{MM}{DD}-{NUM}">
                        <small style="color: #6b7280;">Variables disponibles: {YYYY}, {MM}, {DD}, {NUM}</small>
                    </div>
                    
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <hr style="margin: 1rem 0; border: none; border-top: 1px solid #e5e7eb;">
                        <h5 style="margin: 1rem 0;">Mode de tarification</h5>
                    </div>
                    
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="mode_tarification" value="CHAMBRE" id="mode_tarif_chambre" checked onchange="togglePrixGlobal()">
                            <span style="margin-left: 0.5rem;">Prix fixe par chambre (chaque chambre a son propre prix)</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer; margin-top: 0.5rem;">
                            <input type="radio" name="mode_tarification" value="ETABLISSEMENT" id="mode_tarif_etablissement" onchange="togglePrixGlobal()">
                            <span style="margin-left: 0.5rem;">Prix global √©tablissement (prix total identique quel que soit le nombre de chambres)</span>
                        </label>
                    </div>
                    
                    <div class="form-group" id="prixGlobalGroup" style="display: none;">
                        <label>Prix global par nuit√©e *</label>
                        <input type="number" name="prix_global_nuitee" id="prix_global_nuitee" min="0" step="0.01" placeholder="0.00">
                    </div>
                    
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Notes</label>
                        <textarea name="notes" id="notes" rows="2"></textarea>
                    </div>
                </div>
            </div>

            <!-- √âtape 2: Informations Administrateur -->
            <div class="wizard-content" id="wizardStep2" style="display: none;">
                <h4 style="margin-bottom: 1.5rem; color: #6366f1;">√âtape 2 : Informations de la personne de base (Administrateur)</h4>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nom d'utilisateur (Username) *</label>
                        <input type="text" name="admin_username" id="admin_username" required>
                    </div>
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" name="admin_email" id="admin_email" required>
                    </div>
                    <div class="form-group">
                        <label>Mot de passe *</label>
                        <input type="password" name="admin_password" id="admin_password" required>
                    </div>
                    <div class="form-group">
                        <label>Confirmer le mot de passe *</label>
                        <input type="password" name="admin_password_confirm" id="admin_password_confirm" required>
                    </div>
                    <div class="form-group">
                        <label>Pr√©nom *</label>
                        <input type="text" name="admin_prenom" id="admin_prenom" required>
                    </div>
                    <div class="form-group">
                        <label>Nom *</label>
                        <input type="text" name="admin_nom" id="admin_nom" required>
                    </div>
                    <div class="form-group">
                        <label>T√©l√©phone</label>
                        <input type="tel" name="admin_telephone" id="admin_telephone">
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" name="admin_page_acces" id="admin_page_acces" checked>
                            <span style="margin-left: 0.5rem;">Page d'acc√®s (acc√®s au tableau de bord)</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- √âtape 3: Configuration Chambres -->
            <div class="wizard-content" id="wizardStep3" style="display: none;">
                <h4 style="margin-bottom: 1.5rem; color: #6366f1;">√âtape 3 : Configuration des chambres</h4>
                
                <p style="margin-bottom: 1rem; color: #6b7280;">√âtablissement: <strong id="recapEtablissement">-</strong></p>
                <p style="margin-bottom: 1.5rem; color: #6b7280;" id="modeTarifInfo">Mode de tarification: <strong id="recapModeTarif">-</strong></p>
                
                <div id="chambresContainer"></div>
                <div style="margin-top: 1rem;">
                    <button type="button" class="btn btn-secondary btn-small" onclick="addChambreRow()">+ Ajouter une chambre</button>
                </div>
            </div>

            <!-- √âtape 4: R√©capitulatif -->
            <div class="wizard-content" id="wizardStep4" style="display: none;">
                <h4 style="margin-bottom: 1.5rem; color: #6366f1;">√âtape 4 : R√©capitulatif et validation</h4>
                
                <div class="dotted-section section-blue">
                    <h5 style="margin-bottom: 1rem;">Informations de l'√©tablissement</h5>
                    <div id="recapEtablissementDetails"></div>
                </div>
                
                <div class="dotted-section section-green" style="margin-top: 1.5rem;">
                    <h5 style="margin-bottom: 1rem;">Administrateur</h5>
                    <div id="recapAdminDetails"></div>
                </div>
                
                <div class="dotted-section section-purple" style="margin-top: 1.5rem;">
                    <h5 style="margin-bottom: 1rem;">Chambres</h5>
                    <div id="recapChambresDetails"></div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="button-group" style="justify-content: space-between; margin-top: 2rem;">
                <button type="button" class="btn btn-secondary" id="btnPrevious" onclick="previousStep()" style="display: none;">‚Üê Pr√©c√©dent</button>
                <div style="flex: 1;"></div>
                <button type="button" class="btn btn-secondary" onclick="closeCreateTenantModal()">Annuler</button>
                <button type="button" class="btn btn-primary" id="btnNext" onclick="nextStep()">Suivant ‚Üí</button>
                <button type="button" class="btn btn-success" id="btnSubmit" onclick="createTenant()" style="display: none;">‚úì Cr√©er le compte</button>
            </div>
        </form>
    </div>
</div>

<style>
.wizard-step {
    position: relative;
    z-index: 1;
    text-align: center;
    flex: 1;
}
.wizard-step-number {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: #e5e7eb;
    color: #9ca3af;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    margin: 0 auto 0.5rem;
    transition: all 0.3s ease;
}
.wizard-step-number.active {
    background: #6366f1;
    color: white;
}
.wizard-step-number.completed {
    background: #10b981;
    color: white;
}
.wizard-step-label {
    font-size: 0.875rem;
    color: #6b7280;
    font-weight: 500;
}
.wizard-content {
    min-height: 400px;
}
</style>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/platform_admin.js') }}"></script>
{% endblock %}
